<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
 * tmlib.js v0.1.5
 * http://github.com/phi1618/tmlib.js
 * MIT licensed
 * 
 * Copyright (C) 2010 phi, http://tmlife.net
 */


(function() { &quot;use strict&quot;; })();

/*
 * tm namespace
 */
var tm = tm || {};
tm.global = window || global || this;

(function() {
    
<span id='tm-VERSION'>    /**
</span>     * バージョン
     */
    tm.VERSION = &quot;0.1.5&quot;;
    
    /**
<span id='tm-LIB_ROOT'>     * tmlib.js のルートパス
</span>     */
    tm.LIB_ROOT = (function(){
        if (!window.document) return ;
        
        var scripts = document.getElementsByTagName(&quot;script&quot;);
        for (var i=0, len=scripts.length; i&lt;len; ++i) {
            
        }
    })();
    
    /**
     * ブラウザ
<span id='tm-BROWSER'>     */
</span>    tm.BROWSER = (function() {
        if (!window.navigator) return ;
        
        if      (/chrome/i.test(navigator.userAgent))   { return &quot;Chrome&quot;;  }
        else if (/safari/i.test(navigator.userAgent))   { return &quot;Safari&quot;;  }
        else if (/firefox/i.test(navigator.userAgent))  { return &quot;Firefox&quot;; }
        else if (/opera/i.test(navigator.userAgent))    { return &quot;Opera&quot;;   }
        else if (/getcko/i.test(navigator.userAgent))   { return &quot;Getcko&quot;;  }
        else if (/msie/i.test(navigator.userAgent))     { return &quot;IE&quot;;      }
        else { return null; }
    })();
    
    /**
     * ベンダープレフィックス
<span id='tm-VENDER_PREFIX'>     */
</span>    tm.VENDER_PREFIX = (function() {
        if (!window) return ;
        
        var map = {
            &quot;Chrome&quot;    : &quot;webkit&quot;,
            &quot;Safari&quot;    : &quot;webkit&quot;,
            &quot;Firefox&quot;   : &quot;moz&quot;,
            &quot;Opera&quot;     : &quot;o&quot;,
            &quot;IE&quot;        : &quot;ms&quot;
        };
        
        return map[tm.BROWSER] || &quot;&quot;;
    })();
    
    
    /**
     * モバイルかどうかの判定フラグ
     */
<span id='tm-VENDER_PREFIX-property-isMobile'>    tm.isMobile = (function() {
</span>        if (!window.navigator) return ;
        
        var ua = navigator.userAgent;
        return (ua.indexOf(&quot;iPhone&quot;) &gt; 0 || ua.indexOf(&quot;iPad&quot;) &gt; 0 || ua.indexOf(&quot;Android&quot;) &gt; 0);
    })();
    
    
    /**
     * クラス定義
     */
    tm.createClass = function(prop) {
<span id='tm-VENDER_PREFIX-method-createClass'>        // デフォルト値
</span>        prop.init = prop.init || function() {};
        prop.superClass = prop.superClass || null;
        
        // クラス作成
        var tm_class = function() {
            var temp = new tm_class.prototype.creator();
            tm_class.prototype.init.apply(temp, arguments);
            return temp
        };
        
        // 継承
        if (prop.superClass) {
            tm_class.prototype = Object.create(prop.superClass.prototype);
            tm_class.prototype.superInit = function() {
                // 一時的に superClass として扱われるようにする
                var temp_proto = this.__proto__;
                this.__proto__ = prop.superClass.prototype;
                // 親の初期化を呼び出す
                prop.superClass.prototype.init.apply(this, arguments);
                // 元に戻す
                this.__proto__ = temp_proto;
            };
        }
        
        tm_class.prototype.selfClass = tm_class;
        
        // プロパティを追加
        for (var key in prop) {
            tm_class.prototype[key] = prop[key];
        }
        
        // クリエイタの生成
        tm_class.prototype.creator = function() { return this; };
        // クリエイタの継承
        tm_class.prototype.creator.prototype = tm_class.prototype;
        
        return tm_class;
    };
    
    
    /**
     * 使用する
     */
    tm.using = function() {
        for (var key in tm) {
            window[key] = tm[key];
        }
    };
    
    /**
     * ループ
     */
    tm.setLoop = function(fn, delay) {
<span id='tm-VENDER_PREFIX-method-using'>        var temp = function() {
</span>            // 開始時間
            var start = (new Date()).getTime();
            
            // 実行
            fn();
            
<span id='tm-VENDER_PREFIX-method-setLoop'>            // 経過時間
</span>            var progress = (new Date()).getTime() - start;
            // 次回までの待ち時間を計算
            var newDelay = delay-progress;
            newDelay = (newDelay &gt; 0) ? newDelay : 0;
            
            // 次回呼び出し登録
            setTimeout(arguments.callee, newDelay);
        };
        setTimeout(temp, delay);
    };
    
    /**
     * キーコード
     */
    tm.keyCode = {
        &quot;backspace&quot; : 8,
        &quot;tab&quot;       : 9,
        &quot;enter&quot;     : 13, &quot;return&quot;    : 13,
        &quot;shift&quot;     : 16,
        &quot;ctrl&quot;      : 17,
        &quot;alt&quot;       : 18,
        &quot;pause&quot;     : 19,
        &quot;capslock&quot;  : 20,
        &quot;escape&quot;    : 27,
<span id='tm-VENDER_PREFIX-property-keyCode'>        &quot;pageup&quot;    : 33,
</span>        &quot;pagedown&quot;  : 34,
        &quot;end&quot;       : 35,
        &quot;home&quot;      : 36,
        &quot;left&quot;      : 37,
        &quot;up&quot;        : 38,
        &quot;right&quot;     : 39,
        &quot;down&quot;      : 40,
        &quot;insert&quot;    : 45,
        &quot;delete&quot;    : 46,
        
        &quot;0&quot; : 48,
        &quot;1&quot; : 49,
        &quot;2&quot; : 50,
        &quot;3&quot; : 51,
        &quot;4&quot; : 52,
        &quot;5&quot; : 53,
        &quot;6&quot; : 54,
        &quot;7&quot; : 55,
        &quot;8&quot; : 56,
        &quot;9&quot; : 57,
        
        &quot;a&quot; : 65, &quot;A&quot; : 65,
        &quot;b&quot; : 66, &quot;B&quot; : 66,
        &quot;c&quot; : 67, &quot;C&quot; : 67,
        &quot;d&quot; : 68, &quot;D&quot; : 68,
        &quot;e&quot; : 69, &quot;E&quot; : 69,
        &quot;f&quot; : 70, &quot;F&quot; : 70,
        &quot;g&quot; : 71, &quot;G&quot; : 71,
        &quot;h&quot; : 72, &quot;H&quot; : 72,
        &quot;i&quot; : 73, &quot;I&quot; : 73,
        &quot;j&quot; : 74, &quot;J&quot; : 74,
        &quot;k&quot; : 75, &quot;K&quot; : 75,
        &quot;l&quot; : 76, &quot;L&quot; : 76,
        &quot;m&quot; : 77, &quot;M&quot; : 77,
        &quot;n&quot; : 78, &quot;N&quot; : 78,
        &quot;o&quot; : 79, &quot;O&quot; : 79,
        &quot;p&quot; : 80, &quot;P&quot; : 80,
        &quot;q&quot; : 81, &quot;Q&quot; : 81,
        &quot;r&quot; : 82, &quot;R&quot; : 82,
        &quot;s&quot; : 83, &quot;S&quot; : 83,
        &quot;t&quot; : 84, &quot;T&quot; : 84,
        &quot;u&quot; : 85, &quot;U&quot; : 85,
        &quot;v&quot; : 86, &quot;V&quot; : 86,
        &quot;w&quot; : 87, &quot;W&quot; : 87,
        &quot;x&quot; : 88, &quot;X&quot; : 88,
        &quot;y&quot; : 89, &quot;Y&quot; : 89,
        &quot;z&quot; : 90, &quot;Z&quot; : 90,
        
        &quot;numpad0&quot; : 96,
        &quot;numpad1&quot; : 97,
        &quot;numpad2&quot; : 98,
        &quot;numpad3&quot; : 99,
        &quot;numpad4&quot; : 100,
        &quot;numpad5&quot; : 101,
        &quot;numpad6&quot; : 102,
        &quot;numpad7&quot; : 103,
        &quot;numpad8&quot; : 104,
        &quot;numpad9&quot; : 105,
        &quot;multiply&quot;      : 106,
        &quot;add&quot;           : 107,
        &quot;subtract&quot;      : 109,
        &quot;decimalpoint&quot;  : 110,
        &quot;divide&quot;        : 111,
        
        &quot;f1&quot;    : 112,
        &quot;f2&quot;    : 113,
        &quot;f3&quot;    : 114,
        &quot;f4&quot;    : 115,
        &quot;f5&quot;    : 116,
        &quot;f6&quot;    : 117,
        &quot;f7&quot;    : 118,
        &quot;f8&quot;    : 119,
        &quot;f9&quot;    : 120,
        &quot;f10&quot;   : 121,
        &quot;f11&quot;   : 122,
        &quot;f12&quot;   : 123,
        
        &quot;numlock&quot;   : 144,
        &quot;scrolllock&quot;: 145,
        &quot;semicolon&quot; : 186,
        &quot;equalsign&quot; : 187,
        &quot;comma&quot;     : 188,
        &quot;dash&quot;      : 189,
        &quot;period&quot;    : 190,
        &quot;forward slash&quot; : 191,  &quot;/&quot;: 191,
        &quot;grave accent&quot;  : 192,
        &quot;open bracket&quot;  : 219,
        &quot;back slash&quot;    : 220,
        &quot;close braket&quot;  : 221,
        &quot;single quote&quot;  : 222,
        
        
        
        &quot;space&quot;         : 32
    };
    
    
    tm.inform = function(parent){
        parent = parent || document.body;
        
        var eInfo = document.createElement(&quot;div&quot;);
        eInfo.setAttribute(&quot;class&quot;, &quot;tm-info&quot;);
        eInfo.addEventListener(&quot;mouseover&quot;, function(){
            this.style.opacity = 0.9;
        }, false);
        eInfo.addEventListener(&quot;mouseout&quot;, function(){
            this.style.opacity = 0.25;
        }, false);
        
        with(eInfo.style) {
            position    = &quot;absolute&quot;;
            width       = &quot;100%&quot;;
            // top         = &quot;0px&quot;;
            bottom      = &quot;0px&quot;;
            left        = &quot;0px&quot;;
            right       = &quot;0px&quot;;
            margin      = &quot;0px&quot;;
            padding     = &quot;10px 0px&quot;;
            zIndex      = &quot;0&quot;;
            textAlign   = &quot;center&quot;;
            fontFamily  = '&quot;Meiryo&quot;, &quot;メイリオ&quot;, &quot;ヒラギノ角ゴ Pro W3&quot;, sans-serif';
            fontSize    = &quot;13px&quot;;
            opacity     = &quot;0.25&quot;;
            backgroundColor = &quot;rgb(230,230,255)&quot;;
            background  = &quot;-webkit-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)&quot;;
            background  = &quot;-moz-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)&quot;;
            WebkitTransition = &quot;1s&quot;;
            MozTransition = &quot;1s&quot;;
        }
        
        /*
        eInfo.innerHTML = &quot;このプログラムで利用している JavaScript ライブラリ 『tmlib.js』 は&lt;a href='{tmlibLink}'&gt;こちら&lt;/a&gt;からダウンロードできます. 詳しくは&lt;a href='{blogLink}'&gt;Blog&lt;/a&gt;に書いています.&quot;.format({
            &quot;tmlibLink&quot;: &quot;http://code.google.com/p/tmlib-js/downloads/list&quot;,
            &quot;blogLink&quot; : &quot;http://tmlife.net/tmlib&quot;
        });
        */
        eInfo.innerHTML = &quot;このプログラムで利用している JavaScript ライブラリ 『tmlib.js』 については&lt;a href='{projectLink}'&gt;こちら&lt;/a&gt;.&quot;.format({
            &quot;projectLink&quot; : &quot;https://github.com/phi1618/tmlib.js&quot;
        });
        parent.appendChild(eInfo);
    };
    
})();


(function() {
    
    if (!window) return ;
    
    if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window[tm.VENDER_PREFIX + &quot;RequestAnimationFrame&quot;] || function(callback) {
            window.setTimeout(callback, 1000/60);
        };
    }
    
    if (!window.cancelRequestAnimationFrame) {
        window.cancelRequestAnimationFrame = window[tm.VENDER_PREFIX + &quot;CancelRequestAnimationFrame&quot;] || window.clearTimeout;
    }
    
})();



(function() {
    if (!window.document) return ;
    
    _loadCheckList = [];
    tm.addLoadCheckList = function(obj) {
        console.assert(obj.isLoaded !== undefined, &quot;isLoaded が定義されていません!!&quot;);
        
        _loadCheckList.push(obj);
    };
    
    _preloadListners = [];
    _mainListners = [];
    
    tm.preload = function(fn) { _preloadListners.push(fn); };
    tm.main    = function(fn) { _mainListners.push(fn); };
    
    var _preload = function() {
        
        for (var i=0,len=_preloadListners.length; i&lt;len; ++i) {
            _preloadListners[i]();
        }
        _preloadListners = [];
    };
    
    var _main = function() {
        for (var i=0,len=_loadCheckList.length; i&lt;len; ++i) {
            var c = _loadCheckList[i];
            if (c.isLoaded() == false) {
                setTimeout(arguments.callee, 0);
                return ;
            }
        }
        
        for (var i=0,len=_mainListners.length; i&lt;len; ++i) {
            _mainListners[i]();
        }
        
        _mainListners = [];
    };
    
    window.addEventListener(&quot;load&quot;, function() {
        
        _preload();
        
        _main();
        
    }, false);

})();




</pre>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
 * anim.js
 */

tm.app = tm.app || {};



(function() {
    
<span id='tm-app-Animation'>    /**
</span>     * @class
     * アニメーションクラス
     */
    tm.app.Animation = tm.createClass({
        
        superClass: tm.event.EventDispatcher,

        isAnimation: false,
        
<span id='tm-app-Animation-method-init'>        /**
</span>         * 初期化
         */
        init: function(elm) {
            this.superInit();

            this.tweens     = [];
            this.setTarget(elm);
        },
        
<span id='tm-app-Animation-method-update'>        /**
</span>         * @method
         * 更新
         */
        update: function(app) {
            var tweens = this.tweens.clone();
            for (var i=0,len=tweens.length; i&lt;len; ++i) {
                var tween = tweens[i];
                
                // 待ちチェック
                if (tween.delay &gt; 0) {
                    tween.delay -= 1000/app.fps;
                    continue;
                }
                
                var time = tween.time + 1000/app.fps;
                tween._setTime(time);
                
                if (tween.time &gt;= tween.duration) {
                    // 削除
                    this.tweens.erase(tween);
                    
                    // 全てのアニメーション終了チェック
                    if (this.tweens.length &lt;= 0) {
                        this.isAnimation = false;
                        var e = tm.event.Event(&quot;animationend&quot;);
                        this.element.dispatchEvent(e);
                        this.dispatchEvent(e);
                    }
                }
                else {
                    tween.update();
                }
            }
        },
        
        addTween: function(param)
        {
            if (!param.target) param.target = this.element;
            
            var tween = tm.anim.Tween();
            var begin = {}; begin[param.prop] = param.begin;
            var finish= {}; finish[param.prop] = param.finish;
            tween.fromTo(param.target, begin, finish, param.duration, param.func);
            
            tween.delay = param.delay || 0;
            this.tweens.push(tween);
            
            if (this.isAnimation == false) {
                this.isAnimation = true;
                var e = tm.event.Event(&quot;animationstart&quot;);
                this.element.dispatchEvent(e);
            }
            
            return tween;
        },
        
        addTweens: function(args)
        {
            for (var i=0,len=arguments.length; i&lt;len; ++i) {
                var param = arguments[i];
                this.addTween(param);
            }
            
            return this;
        },
        
        move: function(x, y, duration, fn)
        {
            duration = (duration !== undefined) ? duration : 1000;
            fn       = fn || &quot;linear&quot;;
        
            this.by(&quot;x&quot;, x, duration, fn);
            this.by(&quot;y&quot;, y, duration, fn);

            return this;
        },
        
        moveTo: function(x, y, duration, fn)
        {
            duration = (duration !== undefined) ? duration : 1000;
            fn       = fn || &quot;linear&quot;;

            this.to(&quot;x&quot;, x, duration, fn);
            this.to(&quot;y&quot;, y, duration, fn);
            
            return this;
        },
        
        scale: function(value, duration, delay)
        {
            duration = (duration !== undefined) ? duration : 1000;

            this.to(&quot;scaleX&quot;, value, duration, delay);
            this.to(&quot;scaleY&quot;, value, duration, delay);

            return this;
        },

        rotate: function(value, duration, delay) {
            this.to(&quot;rotation&quot;, value, duration, delay);
            return this;
        },
        
        fade: function(value, duration, delay) {
            this.to(&quot;alpha&quot;, value, duration, delay);
            return this;
        },

        fadeIn: function(duration, delay)
        {
            return this.fade(1.0, duration, delay);
        },
        
        fadeOut: function(duration, delay)
        {
            return this.fade(0.0, duration, delay);
        },
        
        clear: function() {
            this.tweens = [];
            return this;
        },

        setTarget: function(target) {
            if (this._fn) {
                this.element.removeEventListener(&quot;enterframe&quot;, this._fn);
            }

            this.element = target;
            this._fn = function(e) { this.update(e.app); }.bind(this);
            this.element.addEventListener(&quot;enterframe&quot;, this._fn);
        },
        getTarget: function(target) {
            return this.element;
        },

        by: function(prop, value, duration, delay, fn) {
            duration = (duration !== undefined) ? duration : 1000;
            this.addTween({
                prop: prop,
                begin: this.element[prop],
                finish: this.element[prop] + value,
                duration: duration,
                delay: delay,
                func: fn,
            });

            return this;
        },

        to: function(prop, value, duration, delay, fn) {
            duration = (duration !== undefined) ? duration : 1000;
            this.addTween({
                prop: prop,
                begin: this.element[prop],
                finish: value,
                duration: duration,
                delay: delay,
                func: fn,
            });

            return this;
        }
    });
    
    
<span id='tm-app-Animation-property-animation'>    /**
</span>     * @property    animation
     * アニメーション
     */
    tm.app.Element.prototype.getter(&quot;animation&quot;, function() {
        if (!this._animation) {
            this._animation = tm.app.Animation(this);
        }
        
        return this._animation;
    });
    
})();




</pre>
</body>
</html>
